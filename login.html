<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Registration</title>
    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="http://login2explore.com/jpdb/resources/js/0.0.3/jpdb-commons.js"></script>
  </head>
  <body class="bg-light">
    <div class="container mt-5">
      <div class="row justify-content-center">
        <div class="col-md-6">
          <div class="card shadow">
            <div class="card-header bg-primary text-white text-center">
              <h4>Login</h4>
            </div>
            <div class="card-body">
              <form action="" method="post">
                <table class="table">
                  <tbody>
                    <tr class="mb-3">
                      <td><label for="username">Username: </label></td>
                      <td>
                        <input
                          class="form-control"
                          id="username"
                          name="username"
                          type="text"
                          placeholder="Enter your username"
                          required />
                      </td>
                    </tr>
                    <tr class="mb-3">
                      <td><label for="name">Password: </label></td>
                      <td>
                        <input
                          class="form-control"
                          id="password"
                          name="password"
                          type="password"
                          placeholder="Enter your password"
                          required />
                      </td>
                    </tr>

                    <tr class="d-grid">
                      <td align="center">
                        <input
                          type="button"
                          class="btn btn-primary"
                          value="login"
                          onclick="login()" />
                      </td>
                    </tr>
                  </tbody>
                </table>
              </form>
            </div>
            <div class="card-footer text-muted text-center">
              Not registered? <a href="/register.html">Register here</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap 5 JS (optional, for interactive components) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      function executeCommand(reqString, dbBaseUrl, apiEndPointUrl) {
        var url = dbBaseUrl + apiEndPointUrl;
        var jsonObj;
        $.post(url, reqString, function (result) {
          jsonObj = JSON.parse(result);
        }).fail(function (result) {
          var dataJsonObj = result.responseText;
          jsonObj = JSON.parse(dataJsonObj);
        });
        return jsonObj;
      }
      function login() {
        var token = "90934934|-31949248382090903|90959401";
        var dbname = "CRM";
        var relationName = "User-Data";
        var username = document.getElementById("username").value;
        var password = document.getElementById("password").value;
        var jsonStr = {
          Username: username,
        };
        var reqString = createGETRequest(
          token,
          dbname,
          relationName,
          JSON.stringify(jsonStr)
        );
        alert(reqString);
        jQuery.ajaxSetup({ async: false });
        var resultObj = executeCommand(
          reqString,
          "http://api.login2explore.com:5577",
          "/api/irl"
        );
        jQuery.ajaxSetup({ async: true });

        var data = JSON.stringify(resultObj);

        var res = data.split('"');
        console.log(res);
        var Name = res[18].replace("\\","");
        var Password = res[22].replace("\\","");

        if (Password !== password) {
          alert("Invalid username or password!");
          return;
        } else {
          alert("Welcome " + (Name || username) + "!");
          // Redirect to dashboard.html with username as a query parameter
          window.location.href =
            "dashboard.html?username=" + encodeURIComponent(username);
        }
      }
    </script>
  </body>
</html>
